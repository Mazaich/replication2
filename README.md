# Домашнее задание по теме «Репликация и масштабирование. Часть 2» - Машаев Роман

**Преимущества масштабирования методами репликации**

**1\. Активный master-сервер и пассивный репликационный slave-сервер**

**Основные преимущества:**

Отказоустойчивость - при падении master-сервера slave может быть быстро переведен в активный режим;

Резервное копирование - slave-сервер служит актуальной резервной копией данных;

Разделение нагрузки - запросы на чтение можно направлять на slave, оставляя master для операций записи;

Безопасность - slave можно использовать для аналитических запросов без риска повлиять на основную базу;

Простота обслуживания - технические работы можно проводить на slave без простоя основной системы;

**2\. Master-сервер и несколько slave-серверов**

**Дополнительные преимущества:**

**Горизонтальное масштабирование** - возможность распределять нагрузку чтения между несколькими серверами;

**Географическое распределение** - slave-серверы можно размещать в разных регионах для уменьшения задержек;

**Специализация серверов** - разные slave можно настроить под конкретные задачи:

\- Аналитические запросы;

\- Резервное копирование;

\- Тестовые среды.

**Повышенная доступность** - при выходе из строя одного slave остальные продолжают обслуживать запросы;

**Балансировка нагрузки** - равномерное распределение запросов на чтение между всеми slave-серверами;

**Общие преимущества для обоих подходов:**

Улучшение производительности системы;

Повышение надежности и доступности данных;

Возможность проведения технического обслуживания без простоев;

Масштабируемость при росте нагрузки.


_____________________________________________________________________________________________________________________________________________________________


Задание 2
План для горизонтального и вертикального шардинга базы данных с тремя таблицами: пользователи, книги, магазины.

**Вертикальный шардинг**

Вертикальный шардинг подразумевает разделение таблиц по разным базам данных в зависимости от их функциональности или частоты доступа.

У нас есть следующие таблицы:

- users (id, name, email, password, address, phone)
- books (id, title, author, isbn, price, description)
- shops (id, name, location, contact_info)

План вертикального шардинга:

- Разделим таблицы на два сервера:

Сервер 1: users и shops (часто обновляемые данные, связанные с клиентами и магазинами)

Сервер 2: books (данные, которые редко обновляются, но часто читаются)

- Принцип разделения:

Таблицы users и shops могут быть связаны (например, пользователи делают заказы в магазинах), поэтому их стоит разместить вместе для уменьшения джойнов между серверами.

Таблица books может быть большой и использоваться для поиска и каталога, поэтому ее можно вынести на отдельный сервер.

**Горизонтальный шардинг**

Горизонтальный шардинг подразумевает разделение одной таблицы на несколько шардов по какому-либо ключу.

Рассмотрим горизонтальный шардинг для каждой таблицы:

- **Пользователи (users)**:

Разделим по диапазону id пользователя или по географическому признаку (например, по региону).

Шард 1: пользователи с id от 1 до 1000000

Шард 2: пользователи с id от 1000001 до 2000000

- **Книги (books)**:

Разделим по жанру или по автору (например, по первой букве названия книги).

Шард 1: книги с названием, начинающимся на A-M

Шард 2: книги с названием, начинающимся на N-Z

- **Магазины (shops)**:

Разделим по местоположению (например, по странам или городам).

Шард 1: магазины в Европе

Шард 2: магазины в Азии

**Комбинированный подход**

Мы можем комбинировать вертикальный и горизонтальный шардинг. Например:

Вертикально разделим таблицы по серверам, а затем каждую таблицу горизонтально разделим на шарды.

**Схема 1**

**Режимы работы серверов**

- **Сервер 1** (users, shops): будет обрабатывать операции, связанные с пользователями и магазинами (регистрация, авторизация, управление магазинами, заказы).
- **Сервер 2** (books): будет обрабатывать запросы, связанные с книгами (поиск, отображение каталога).

Каждый шард будет работать в режиме master-slave или master-master в зависимости от требований к согласованности и доступности.

- Для таблицы users и shops можно использовать master-slave репликацию, где master обрабатывает запросы на запись, а slave - на чтение.
- Для таблицы books можно использовать master-slave, но учитывая, что данные редко обновляются, можно иметь несколько slave для чтения.

**Принципы построения системы**

- **Разделение по функциональности** (вертикальный шардинг) уменьшает нагрузку на каждый сервер и позволяет масштабировать отдельные модули независимо.
- **Горизонтальный шардинг** позволяет распределить данные одной таблицы по нескольким серверам, что повышает производительность и отказоустойчивость.
- **Шардинг-ключ** должен выбираться таким образом, чтобы данные распределялись равномерно и минимизировались межшардовые запросы.
- **Репликация** используется для повышения доступности и надежности.

**Дополнительные замечания**

- Необходимо предусмотреть механизм маршрутизации запросов к нужному шарду (например, с помощью шардинг-менеджера или прокси).
- Для обеспечения согласованности данных может потребоваться использовать распределенные транзакции или eventual consistency.
- Резервное копирование и мониторинг должны быть настроены для каждого шарда.

Этот план позволяет масштабировать базу данных как по чтению, так и по записи, и обеспечивает отказоустойчивость.

**План горизонтального и вертикального шардинга базы данных**

**Архитектура системы**

Схема 2

**Вертикальный шардинг (разделение по таблицам)**

**Принцип:** Разделение таблиц между разными серверами по функциональному признаку

**ШАРД 1 (Пользователи):**

users (id, username, email, password, created_at, profile_data)

**ШАРД 2 (Книги):**

books (id, title, author, isbn, price, description, category_id)

**ШАРД 3 (Магазины):**

shops (id, name, location, contact_info, manager_id)

**Преимущества:**

Каждый шард оптимизирован под конкретный тип данных

Уменьшение конкуренции за ресурсы

Простота администрирования

**Горизонтальный шардинг (разделение данных внутри таблиц)**

**Принципы распределения:**

**1\. Пользователи (ШАРД 1):**

**По диапазону ID:** users_001 (1-1M), users_002 (1M-2M), users_003 (2M-3M)

**По географии:** eu_users, us_users, asia_users

**По хэшу email:** hash(email) % number_of_shards

**2\. Книги (ШАРД 2):**

**По категориям:** fiction, non_fiction, academic

**По автору:** author_id % number_of_shards

**По популярности:** hot_books, archive_books

**3\. Магазины (ШАРД 3):**

**По регионам:** north, south, east, west

**По размеру:** large_shops, medium_shops, small_shops

**Режимы работы серверов**

ШАРД 1 (Пользователи):

Master: обработка запросов на запись (регистрация, обновление профиля)

Slave 1: чтение для авторизации, профилей

Slave 2: аналитика, бэкапы

ШАРД 2 (Книги):

Master: добавление/обновление книг, изменение цен

Slave 1: поиск книг, каталог

Slave 2: рекомендации, статистика

ШАРД 3 (Магазины):

Master: управление магазинами, обновление информации

Slave 1: геопоиск, отображение магазинов

Slave 2: отчеты, аналитика продаж
